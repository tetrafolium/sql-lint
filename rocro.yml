---
inspecode:

  # global:
  #   runtime:
  #     go: 1.14

  # experimental:
  #   env:
  #     GO111MODULE: auto

  tasks:

    - name: dockerfilelint
      type: docker-build
      dockerfile: '.rocro/dflint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/dockerfilelint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 2}

    - name: hadolint
      type: docker-build
      dockerfile: '.rocro/hadolint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/hadolint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 13}

    - name: sql-lint
      type: docker-build
      dockerfile: '.rocro/sqllint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/sql-lint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 14}

    - name: yamllint
      type: docker-build
      dockerfile: '.rocro/yamllint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/yamllint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 3}

  tools:

    clang-format:
      auto-fix: true
      thresholds: {num-issues: 75}

    # fortify:
    #   thresholds: {num-issues: 999}

    fossology:
      thresholds: {num-issues: 27}

    grep:
      thresholds: {num-issues: 0}

    jscpd:
      thresholds: {num-issues: 15}

    misspell:
      auto-fix: true
      thresholds: {num-issues: 1}

    prettier:
      auto-fix: true
      thresholds: {num-issues: 7}

    tslint:
      auto-fix: true
      thresholds: {num-issues: 19}
