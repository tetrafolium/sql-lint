---
inspecode:

  global:
    runtime:
      go: 1.14

  experimental:
    env:
      GO111MODULE: auto

  tasks:

    - name: dockerfilelint
      type: docker-build
      dockerfile: '.rocro/dflint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        downloads:
          - stage: linter-stage
            path: "/.reports/dockerfilelint.json"
          - stage: linter-stage
            path: "/.reports/dockerfilelint.sarif"
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/dockerfilelint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 2}

    - name: hadolint
      type: docker-build
      dockerfile: '.rocro/hadolint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        downloads:
          - stage: linter-stage
            path: "/.reports/hadolint.json"
          - stage: linter-stage
            path: "/.reports/hadolint.sarif"
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/hadolint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 13}

    - name: sql-lint
      type: docker-build
      dockerfile: '.rocro/sqllint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        downloads:
          - stage: linter-stage
            path: "/.reports/sql-lint.issues"
          - stage: linter-stage
            path: "/.reports/sql-lint.sarif"
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/sql-lint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 9}

    - name: yamllint
      type: docker-build
      dockerfile: '.rocro/yamllint/Dockerfile'
      options:
        --context: .
        --build-arg: [OUTDIR=/.reports]
      artifacts:
        downloads:
          - stage: linter-stage
            path: "/.reports/yamllint.issues"
          - stage: linter-stage
            path: "/.reports/yamllint.sarif"
        uploads:
          - stage: linter-stage
            path: "/.reports/"
      reports:
        - stage: linter-stage
          path: "/.reports/yamllint.sarif"
      machine: {cpu: 0.75}
      thresholds: {num-issues: 4}

  tools:

    #### temporary deleted
